// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Student {
  id            Int      @id @default(autoincrement())
  studentId     String   @unique // شماره دانش‌آموزی
  firstName     String
  lastName      String
  fatherName    String
  nationalId    String   @unique
  birthDate     DateTime
  grade         Int      // پایه تحصیلی (1-6)
  section       String   // شعبه (الف، ب، ج)
  classId       Int
  enrollmentDate DateTime @default(now())
  isActive      Boolean  @default(true)
  
  // Relations
  class         Class    @relation(fields: [classId], references: [id])
  attendances   Attendance[]
  payments      Payment[]
  
  @@map("students")
}

model Teacher {
  id            Int      @id @default(autoincrement())
  employeeId    String   @unique
  firstName     String
  lastName      String
  nationalId    String   @unique
  phone         String
  email         String?
  hireDate      DateTime
  isActive      Boolean  @default(true)
  
  // Relations
  classes       Class[]
  
  @@map("teachers")
}

model Class {
  id            Int      @id @default(autoincrement())
  grade         Int      // پایه (1-6)
  section       String   // شعبه (الف، ب، ج)
  teacherId     Int
  capacity      Int      @default(30)
  isActive      Boolean  @default(true)
  
  // Relations
  teacher       Teacher  @relation(fields: [teacherId], references: [id])
  students      Student[]
  attendances   Attendance[]
  
  @@unique([grade, section])
  @@map("classes")
}

model Attendance {
  id            Int      @id @default(autoincrement())
  studentId     Int
  classId       Int
  date          DateTime
  status        String // PRESENT, ABSENT, LATE, EXCUSED
  notes         String?
  createdAt     DateTime @default(now())
  
  // Relations
  student       Student  @relation(fields: [studentId], references: [id])
  class         Class    @relation(fields: [classId], references: [id])
  
  @@unique([studentId, date])
  @@map("attendances")
}

model Payment {
  id            Int      @id @default(autoincrement())
  studentId     Int
  amount        Float
  dueDate       DateTime
  paidDate      DateTime?
  status        String // PENDING, PAID, OVERDUE, CANCELLED
  type          String // TUITION, MEAL, TRANSPORT, ACTIVITY, OTHER
  description   String?
  createdAt     DateTime @default(now())
  
  // Relations
  student       Student  @relation(fields: [studentId], references: [id])
  
  @@map("payments")
}

model Announcement {
  id            Int      @id @default(autoincrement())
  title         String
  content       String
  priority      String // LOW, MEDIUM, HIGH
  author        String
  publishDate   DateTime @default(now())
  isActive      Boolean  @default(true)
  targetAudience String  @default("all") // all, teachers, parents
  
  @@map("announcements")
}

model MealService {
  id            Int      @id @default(autoincrement())
  date          DateTime
  mealType      String // BREAKFAST, LUNCH, SNACK
  menuItems     String
  totalOrders   Int      @default(0)
  isActive      Boolean  @default(true)
  
  @@map("meal_services")
}

// Note: SQLite doesn't support enums, so we use strings with comments
// AttendanceStatus: PRESENT, ABSENT, LATE, EXCUSED
// PaymentStatus: PENDING, PAID, OVERDUE, CANCELLED  
// PaymentType: TUITION, MEAL, TRANSPORT, ACTIVITY, OTHER
// AnnouncementPriority: LOW, MEDIUM, HIGH
// MealType: BREAKFAST, LUNCH, SNACK
